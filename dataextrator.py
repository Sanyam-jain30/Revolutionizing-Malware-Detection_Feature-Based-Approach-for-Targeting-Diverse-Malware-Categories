import time
import json
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.select import Select

driver = webdriver.Chrome()

classify = ['Mirai', 'Joker', 'Fabookie', 'Amadey', 'AgentTesla', 'Rhadamanthys', 'RedLineStealer',
            'Loki', 'GuLoader', 'Smoke Loader', 'OskiStealer', 'Gafgyt', 'CoinMiner', 'Arechclient2']

f = open('result.json')
listsha = json.load(f)

def web_scrape_malware_bazaar():
    for malware in classify:
        url = "https://bazaar.abuse.ch/browse/signature/" + malware
        listsha[malware] = []
        driver.get(url)

        time.sleep(20)
        select = Select(driver.find_element(By.NAME, 'signature_table_length'))
        select.select_by_visible_text('All')

        table = driver.find_element(By.ID, 'signature_table')

        rows = table.find_elements(By.TAG_NAME, 'tr')
        for row in rows[1:]:
            td = row.find_elements(By.TAG_NAME, 'td')
            listsha[malware].append(td[1].text)

        print(len(listsha[malware]))

        listsha[malware] = list(set(listsha[malware]))

        with open("result.json", 'w') as json_file:
            json.dump(listsha, json_file)

if __name__ == "__main__":
    web_scrape_malware_bazaar()
    driver.quit()